---
title: "Intro to coding and R"
author: Ben Harden
date: '2021-05-05'
level: 1
slug: []
categories: []
tags: []
draft: no
quiz: https://classroom.google.com/c/NjgxMDE4NDM5Mzky/a/Njk3ODg3MTk3NTA1/details
---

For our data exploration and visualization work, we are going to use a programming language called R. R is a very popular tool for working with data in sciences and is a one-stop-shop for work from data input and organization, to graphics and web presentations. In fact this whole website was build within R. There is a lot to it and it can feel overwhelming at first so hold tight if you've never done any of this kind of work before.

## What is R and why use it?

R is a programming language. That means it's a piece of computer software that can interpret written commands and execute them in sequence to do a specific task such as, in our case, read in data and create a figure. There are many many programming languages out there, most with a specific goal in mind. HTML, which makes websites, is one example. You may have heard of others (or may be using them in your upcoming projects) such as python, MATLAB, java, fortran...

The main contrast to using something like R is to use Excel. I'm assuming most of you have used this to look at data. Excel is a very visual way to work with data and make plots, and is pretty easy to learn, but this usability comes at a price:

* In Excel, the interface is point-and-click meaning you select data using your mouse and then select actions from a toolbar. This can be really easy to learn, but is limited because it's hard to record what you have done to your data or indeed do exactly the same thing again another time. R allows you to write scripts which automates this process and makes it reproducible

* In Excel, you work on a sheet and manipulate the data directly. This can result in you accidentally removing data, editing it without being able to undo, or otherwise create a mess wherein the original data becomes a new version with no documentation or ability for someone else to reproduce what you've done. 

* Excel is also not free so we limit our ability to collaborate and interact with the world by keeping the analysis behind a paywall. This has changed a little with the advent of Google Sheets, but the compatibility is still not perfect.

Dr. Rob Schlegel (from the Woods Hole Oceanographic Institution) sums up nicely why using R is a good idea for data science as part of his R workshop.

Please read [section 1.3 of this guide](https://robwschlegel.github.io/Intro_R_Workshop/prelim.html#why-use-r).

## Setting up R

Most people couple the language R with a user interface called RStudio - this is a point-and-click program that takes the simplicity and user-friendly nature of those features to make the coding part easier.

For this class we are going to need to download both R (the language) and RStudio (the user interface) to our computers.

### Installing R

* Go to http://www.r-project.org/, and in the "Getting Started" box, click on “download R.” Find a site of your choice. (The ones at Berkeley and UCLA are closest to us, but you can use any of them.) 
* Click to go to that site.
* Click on your operating system (Windows, MAC, Linux) and follow directions.
* *If Windows, click on "base" and then on Download R 4.4.1 for Windows. (Note that 4.4.1 is the current version as this is being written, but use whatever shows up as current.) You may need to save the file "R-4.4.1-win.exe" and then click on it to execute it. When the dialog box opens, click "RUN." A Setup Wizard should appear. Keep clicking "Next" (or change features if you understand them), until it is finished. You should now see an icon on your desktop, with a large capital “R.”*

### Installing R Studio

Go to http://www.rstudio.com, click on “Download RStudio” and follow the directions for your operating system.


## R Familiarization

Now that we know a little about R and why we might want to use it, it's time to learn some of the basics. If you've never used R or RStudio before it's worth a little bit of orientation.

Watch this video to orient yourself to the RStudio Interface

<iframe width="100%" height = "500" src="https://www.youtube.com/embed/cnQ-v1UUWyE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

### Scripting

The final part of the video above talks about scripting. I like to think of scripts as a little like recipes. You lay out the ingredients and logical steps someone (or future you!) would need to follow in order to get a particular, reproducible outcome. In this case, it's R that is going to follow your script to do a particular analysis or make a plot.

Writing commands in the console is a little like cooking on the fly with whatever you have to hand. Sometimes that's the right way to make a meal (or play with data). Most times though, you're going to want to make a script to record what you've done.

Below is a quick video intro to making a script.

<iframe title="vimeo-player" src="https://player.vimeo.com/video/557632079" width="800" height="600" frameborder="0" allowfullscreen></iframe>

## RStudio Projects and Packages

Finally some notes on Project and Packages

### Projects

When using RStudio it's useful to organize your work in an RStudio Projects. A Project creates a folder where you can store all your data, code and figures in one place. It is more organized and actually makes some of the coding easier, especially reading in data. 

To open a new project, go to "File" and then "New Project". When the popup window appears select "New Directory" and then "New Project". You'll then be asked to choose the name of your project and where the project should exist on your computer. 

Once you've done that you're project will be set up and will automatically load in R.

### Packages

Many pieces of code that you will want to run will rely on packages. Packages in R are a selection of add-on functions - code that has been written by an R user that they think would be helpful enough to others that they have "packaged" it up and made it available.

For this class we just need one package called "tidyverse" (technically a package or a few different packages), which contains some popular functions that help users work with and plot data. Tidyverse does not come pre-installed in R so you will need to do this.

Open RStudio and enter the following in the console:

```{r, eval = F}
install.packages("tidyverse")
```

A bunch of red text will show up for a while as R downloads and installs the packages, but once you're done with this you shouldn't have to run this command again.

## Test your understanding

To test your understanding, you should use what you've heard above to do the following:

1. Create a new project
1. Open a new script file and save it with the name "test_script.R"
1. Use this script to record the steps you would take to do the following:

  * Make a new object which is a vector of the numbers 1, 3, 5, 8, 11, 20
  * Extract the 3rd value in this vector
  * Find the mean and range of this vector
  * Make a new object which is your original object multiplied by 10

Dont forget to comment your lines of code so you know what each line does

Once you're done, you can check your work against [this example script](Viz_L1_example.R)

# Level 1, Part 2 : Reading and making simple plots

### Reading Data

If you've used Excel before, you'll be pretty familiar with the spreadsheet layout of data where we have rows and columns. Many datasets you'll be working with in R are also organized in the same way. R calls them data frames.

![Values are stored at intersection of rows (obserations) and columns (variables)](tidy_1.png)

Watch this brief intro to importing data into a data frame in R, and how it differs from using data in Excel.

<div style="padding:75% 0 0 0;position:relative;"><iframe src="https://player.vimeo.com/video/555320284?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;" title="Sequence 01.mov"></iframe></div><script src="https://player.vimeo.com/api/player.js"></script>

## Plotting Data

The tool we are going to be using is the ggplot package. It's a powerful and flexible way to make graphics and it used widely by scientists analyzing data.
 
For us, our data is going to come from a CTD profile - these are ocean measurements where you lower a device through the water and record various factoes like temperature, salinity and density as a function of depth.

We are going to be using data from a single CTD profile, You can download the data here: [SR04.csv](SR04.csv) and save it into a new project in R.

### Activating packages

So far, we've come across two packages: readr (the package we used to read in our csv file) and ggplot (to make plots). We are going to need both for this exercise because we are now going to be both reading and plotting data. Both come in the tidyverse package, but you need to activate them at the top of your script.

So make sure your script starts with the following:

```{r libraries}
library(readr)
library(ggplot2)
```

If for whatever reason you don't have these packages you can install them 

```{r, eval = F}
install.packages("tidyverse")
```

### Reading in Data

The data should be placed in your project folder so that it is easy for the code to find. We will then read in the data using the `read_csv()` function.

```{r}
profile <- read_csv("SR04.csv")
```

The object `profile` is now a data frame containing the data in `SR04.csv`. It should be available to you in the environment panel where you can click on it to see it in spreadsheet format.

Some things to note about the data from a quick-look:

* The data is already tidy - each row is an observation and each column is a variable.

* The rows are observations at particular depths (z)

* The columns have relatively self-explanatory headings, but we always need the metadata that tells us what each is specifically. In our case:
    + Cruise: Unique identifier for the cruise (oceanographic expedition) on which the data was gathered - there are five different cruises in this data
    + Station: Unique station number (i.e. ID of location where the ship stopped to take the measurements)
    + lon: Longitude (decimal degrees east)
    + lat: Latitude (decimal degrees north)
    + z: Depth (m)
    + pres: Pressure (dbar)
    + temp: Temperature (°C)
    + sal: Salinity
    + theta: Potential Temperature (°C) - the temperature the water would be if it was raised to the surface. This accounts for the slight cooling effect of increased pressure
    + sigma: Potential Density (kgm^-^3)  

### Plotting

We create a simple ggplot using the following template:

```{r template, eval=FALSE}
ggplot(data = <DATA>) + 
  <GEOM_FUNCTION>(mapping = aes(<MAPPINGS>))
```

Where we will need to specify three things:

1. `<DATA>` The tidy data frame used to make the plot
1. `<MAPPINGS>` The mapping of variables to aesthetics - what variable you want to put on thew x axis, y axis, color axis, etc.
1. '<GEOM_FUNCTION>' A geom to represent these aesthetics - how will this look? (points? lines?)

So, as a first example, we can plot the temperature data over depth in the following way:

```{r}
ggplot(data = profile) +
  geom_line(aes(x = z, y = temp))
```

Where we have specified that:

1. Our data is contained in the data frame, `profile`
1. We want to map depth (z) to position along the x axis and temperature (temp) to position along the y axis
1. We want the representation to be a line `geom_line()`

*ASIDE: This is the most verbose way I can write this. Verbose in coding means more explicit or using-lots-of-typing. I have used `data = profiles`, `x = dttm` and `y = temp`. As with many functions in R, both `ggplot()` and `aes()` are expecting certain inputs and instead of officially declaring them, you can just write them in the right order. The above code could be written more succinctly as:*


```{r, eval = FALSE, include = TRUE}
ggplot(profile) +
  geom_line(aes(z, temp))
```

*We've lost something in the ability for us to directly interpret what is being assigned to what, but we're saving our fingers in the long run. It's up to you which makes more sense to you at this point.*

The above figure is what you would plot from a traditional science perspective - the independent variable (z) is on the x axis and the dependent variable (temperature) is on the y axis. However, from an oceanography perspective, it makes more sense to have depth be on the y axis and temperature on the x axis. Like this (flipping the positon of z and temp):

```{r}
ggplot(profile) +
  geom_line(aes(temp, z))
```

Uh oh. What a mess. What's happening here? ggplot actually has two geoms that can draw lines. We've been using `geom_line()` so far, but underneath the hood, this function actually sorts the y variable along the x axis. This can be useful in many cases were data is not sorted already, but in our case it means that the nice sweeping curve gets deconstructed. For our purposes, we're going to want to use `geom_path()` which joins the data up in the order they appear in the data set.

```{r}
ggplot(profile) +
  geom_path(aes(temp, z))
```

The last thing we're going to do to fit with oceanographic norms is to flip the y axis. This will make depth be greater the further you go down the plot.

Doing this in ggplot requires us to use one of the `scale_*` functions. These functions basically say: *Take the mapping we've already set up in out ggplot and adjust how the data is mapped*. This includes telling ggplot what range of values to map to our x axis, whether we want a log axis, what colors to map our data to, and, in our case, what direction to plot the data in. We'll talk more about the `scale_*` functions in Level 3 if you are interested.

```{r}
ggplot(profile) +
  geom_path(aes(temp, z)) +
  scale_y_reverse()
```

So now we have an intuitive way to look at the data. The temperature is around -1.8°C at the surface (top) and increases to a maximum of 2°C at around 300 m before slowly cooling again as you head deeper.

I've zipped a [project file here](Viz_L2_example.zip) that contains the data and the code you would need to run the above visualization. Unzip the folder and double-click on the Viz_L2_example.Rproj file to open this project in RStudio. 

## Exercise

To get signed off at Level 2, you will need to be able to show me an RStudio project that contains the data and a script that:

* Activates the appropriate libraries
* Loads in the data set abov
* Makes at least two x-y plots different to the ones I outlined above
  + each with a different geom
  + each mapping different variables to x and y
* Has comments that describe what each section of code is doing

I can come see this on your computer or you can zip the project folder and send it to me as a DM in Slack.
